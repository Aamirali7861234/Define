<!DOCTYPE html>
<html>
<head>
  <title>Temp Email Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
    }
    .email-box {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    button {
      padding: 10px 15px;
      font-size: 16px;
      margin: 5px;
    }
    .message {
      border: 1px solid #ccc;
      margin-top: 10px;
      padding: 10px;
      text-align: left;
    }
  </style>
</head>
<body>

  <h2>Temporary Email Generator</h2>
  <div class="email-box" id="tempEmail">Loading...</div>
  <button onclick="generateNewEmail()">Change Email</button>

  <h3>Messages:</h3>
  <div id="messages">Checking for OTP...</div>

  <script>
    let login = "";
    let domain = "";

    function generateNewEmail() {
      login = Math.random().toString(36).substring(2, 10);
      domain = "1secmail.com";
      const email = `${login}@${domain}`;
      document.getElementById("tempEmail").textContent = email;
      fetchMessages();
    }

    async function fetchMessages() {
      const messagesDiv = document.getElementById("messages");
      try {
        const response = await fetch(`https://www.1secmail.com/api/v1/?action=getMessages&login=${login}&domain=${domain}`);
        const data = await response.json();
        messagesDiv.innerHTML = "";

        if (data.length === 0) {
          messagesDiv.textContent = "No messages yet.";
        } else {
          for (let msg of data) {
            const mailResp = await fetch(`https://www.1secmail.com/api/v1/?action=readMessage&login=${login}&domain=${domain}&id=${msg.id}`);
            const mail = await mailResp.json();
            messagesDiv.innerHTML += `<div class="message"><strong>From:</strong> ${mail.from}<br><strong>Subject:</strong> ${mail.subject}<br><strong>Text:</strong><br>${mail.textBody}</div>`;
          }
        }
      } catch (err) {
        messagesDiv.textContent = "Error fetching messages.";
      }
    }

    // Refresh every 10 seconds
    setInterval(fetchMessages, 10000);

    // Init
    generateNewEmail();
  </script>

</body>
</html>
